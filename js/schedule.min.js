(function(n){karenapp={log:function(n,t){console.log("[karenapp] "+n,t)}};karenapp.Translations={book_now:{en:"Book now",de:"Jetzt buchen",dk:"Bestil nu",es:"Reservar",fr:"Réserver",nl:"Boek nu",no:"Meld deg på",ru:"Забронировать сейчас"},time:{en:"Time",de:"Zeit",dk:"Tid",es:"Hora",fr:"Horaire",nl:"Tijd",no:"Tid",ru:"Время"},teacher:{en:"Teacher",de:"Lehrer",dk:"Lærer",es:"Profesor",fr:"Professeur",nl:"Leraar",no:"Lærer",ru:"Учитель"},location:{en:"Location",de:"Standort",dk:"Lokation",es:"Ubicación",fr:"Adresse",nl:"Locatie",no:"Sted",ru:"Место нахождения"},room:{en:"Room",de:"Raum",dk:"Værelse",es:"Aula",fr:"Salle",nl:"Ruimte",no:"Rom",ru:"Комната"},get:function(n){if(!(n in this))throw new Exception("Translation key ["+n+"] doesn't exist");var t=navigator.language.substr(0,2);return t in this[n]||(t="en"),this[n][t]}};karenapp.Lesson=function(n){if(!(n instanceof karenapp.Schedule))throw"Pass the Schedule this Lesson belongs to.";this.schedule=n};karenapp.Lesson.prototype={isBookable:function(){return this.status=="cancelled"?!1:this.visit_not_allowed===!0?!1:this.getFromTime()<=Date.now()?!1:!0},getFromTime:function(){return this._fromTime==undefined&&(this._fromTime=this.from_time.toDate("yyyy-mm-dd hh:ii:ss")),this._fromTime},getToTime:function(){return this._toTime==undefined&&(this._toTime=this.to_time.toDate("yyyy-mm-dd hh:ii:ss")),this._toTime},getDateString:function(){return this.getFromTime().toLocaleDateString(navigator.language,{month:"long",day:"numeric"})},getShortTimeString:function(){return this.getFromTime().toLocaleTimeString(navigator.language,{hour:"2-digit",minute:"2-digit"})},getLongTimeString:function(){return this.getFromTime().toLocaleTimeString(navigator.language,{hour:"2-digit",minute:"2-digit"})+" - "+this.getToTime().toLocaleTimeString(navigator.language,{hour:"2-digit",minute:"2-digit"})},getWeekDay:function(){return this.getFromTime().toLocaleDateString(navigator.language,{weekday:"long"})},getLessonUrl:function(){var n=this.schedule.url[this.schedule.url.length-1]=="/"?"":"/",t=n+"lesson/"+this.id+"/"+this.slug;return this.schedule.url+t},getBookUrl:function(){var n=this.schedule.url[this.schedule.url.length-1]=="/"?"":"/",t=n+"visit/confirm/"+this.id;return this.schedule.url+t}};karenapp.Schedule=function(t){this.container=t.empty();this.url=this.container.attr("data-momo-schedule");var i=this.url.match(/\/([a-z0-9-_]+)\/?$/i);this.profile_name=i[1];n.ajax({type:"POST",url:"https://karenapp.io/api/wordpress/lessons",data:{profile_name:this.profile_name},success:this.onScheduleSuccess,error:this.onScheduleFail,context:this,dataType:"json"})};karenapp.Schedule.prototype={getCurrentOrNewSection:function(t){var i=t.getDateString();return i!=this.currentDate&&(this._currentSection=n(document.createElement("div")).addClass("karenapp-section"),this._currentSection.append('<div class="karenapp-day">'+t.getWeekDay()+'<\/div><div class="karenapp-date">'+i+"<\/div>"),this._currentSection.append('<div class="karenapp-lessons"><\/div>'),this.container.append(this._currentSection),this.currentDate=i),this._currentSection},getLessonElement:function(t){var i=n(document.createElement("div")).addClass("karenapp-lesson").attr("id",t.id),u,f,r;return i.append('<div class="karenapp-lesson-time">'+t.getShortTimeString()+"<\/div>"),i.append('<div class="karenapp-lesson-title"><a href="#">'+t.title+"<\/a><\/div>"),i.append('<div class="karenapp-lesson-teacher">'+t.teacher+"<\/div>"),i.append('<div class="karenapp-lesson-action"><\/div>'),i.append('<div class="karenapp-lesson-details"><\/div>'),t.status!==undefined&&i.addClass("karenapp-status-"+t.status),t.isBookable()&&(u=t.getLessonUrl(),f=karenapp.Translations.get("book_now"),i.find(".karenapp-lesson-action").append('<a class="karenapp-lesson-action-booknow" href="'+u+'" target="_blank">'+f+"<\/a>")),r=i.find(".karenapp-lesson-details"),r.append("<p><strong>"+karenapp.Translations.get("time")+"<\/strong>"+t.getLongTimeString()+"<\/p>"),r.append("<p><strong>"+karenapp.Translations.get("teacher")+"<\/strong>"+t.teacher+"<\/p>"),t.location&&r.append("<p><strong>"+karenapp.Translations.get("location")+"<\/strong>"+t.location+"<\/p>"),t.room&&r.append("<p><strong>"+karenapp.Translations.get("room")+"<\/strong>"+t.room+"<\/p>"),r.hide(),i.find(".karenapp-lesson-title > a").click({schedule:this},this.onLessonTitleClicked),i},onLessonTitleClicked:function(t){t.preventDefault();var i=t.data.schedule,r=n(this).parents(".karenapp-lesson").first();if(i.activeLesson!==undefined&&(i.activeLesson.find(".karenapp-lesson-details").hide(),i.activeLesson.attr("id")==r.attr("id"))){i.activeLesson=undefined;return}r.find(".karenapp-lesson-details").show();i.activeLesson=r},onScheduleSuccess:function(t){var i=t[0];i.forEach(function(t){var i=n.extend(new karenapp.Lesson(this),t),r=this.getCurrentOrNewSection(i),u=this.getLessonElement(i);r.find(".karenapp-lessons").append(u)},this)},onScheduleFail:function(n,t,i){karenapp.log(t+": "+i);this.container.append('<span class="error">Failed to retrieve schedule.<\/span>')}};String.prototype.toDate=function(n){var c=this.replace(/[^0-9]/g,"-"),l=n.toLowerCase().replace(/[^a-zA-Z]/g,"-"),t=l.split("-"),i=c.split("-"),u=t.indexOf("mm"),f=t.indexOf("dd"),e=t.indexOf("yyyy"),o=t.indexOf("hh"),s=t.indexOf("ii"),h=t.indexOf("ss"),r=new Date,a=e>-1?i[e]:r.getFullYear(),v=u>-1?i[u]-1:r.getMonth()-1,y=f>-1?i[f]:r.getDate(),p=o>-1?i[o]:r.getHours(),w=s>-1?i[s]:r.getMinutes(),b=h>-1?i[h]:r.getSeconds();return new Date(a,v,y,p,w,b)};n(".karenapp-schedule").empty().first();n("*[data-momo-schedule]").each(function(){new karenapp.Schedule(n(this))})})(jQuery);